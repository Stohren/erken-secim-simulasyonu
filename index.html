<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erken Seçim Anketi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 15px; /* Biraz azaltıldı */
        }

        /* YENİ EKLENEN AÇIKLAMA BÖLÜMÜ STİLİ */
        .aciklama-bolumu {
            background-color: #f9f9f9; /* Hafif farklı bir arka plan */
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 20px; /* Formdan önce boşluk */
            border-radius: 5px;
            text-align: justify; /* Uzun metinler için daha okunaklı */
            font-size: 0.95em;
            color: #444;
        }

        .poll-form-info { /* Mevcut kısa talimat için yeni bir sınıf */
            margin-bottom: 20px;
            text-align: center; /* Ortalamak için */
            font-size: 0.9em;
            color: #555;
        }


        .poll-form fieldset {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .poll-form legend {
            font-size: 1.2em;
            font-weight: bold;
            color: #555;
            padding: 0 10px;
        }

        .poll-form label {
            display: block;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }

        .poll-form input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .poll-form label:hover {
            color: #007bff;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
        }

        .submit-btn:hover {
            background-color: #0056b3;
        }

        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .message {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
        }

        #results-container {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 5px;
        }

        #results-container h2 {
            text-align: center;
            color: #495057;
            margin-bottom: 15px;
        }

        .results-list {
            list-style-type: none;
            padding: 0;
        }

        .results-list li {
            background: #fff;
            margin-bottom: 8px;
            padding: 10px 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .results-list .party-name {
            font-weight: bold;
        }

        .results-list .party-votes {
            background-color: #007bff;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.9em;
        }

        #admin-controls {
            margin-top: 20px;
            text-align: center;
        }

        .admin-btn {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px; /* Butonlar arasına biraz boşluk */
        }
        .admin-btn:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Erken Seçim Anketi</h1>

        <div class="aciklama-bolumu">
            Sevgili katılımcılar. Bu anket tamamıyla bir öğrenci tarafından yapılmakta olup, Ülkemizdeki objektif olmayan anket firmaları, yandaş, anti-demokratik medyaya rağmen, tamamen anonim ve açık bir anket ihtiyacından doğmuştur. Oyunuzu kullanıp bu sitenin linkini paylaşarak, ülkemizin adil demokrasiye olan açlığına bir çözüm bulma yolunda katkı sağlamış olursunuz. Demokratik, adil, barış dolu bir gelecek umuduyla...
        </div>

        <p class="poll-form-info">Lütfen aşağıdaki seçeneklerden birini işaretleyerek oyunuzu kullanın. Katılımınız için teşekkürler!</p>

        <form id="pollForm" class="poll-form">
            <fieldset>
                <legend>Partinizi Seçin</legend>
                <label><input type="radio" name="party" value="Parti A"> Cumhuriyet Halk Partisi</label>
                <label><input type="radio" name="party" value="Parti B"> Adalet ve Kalkınma Partisi</label>
                <label><input type="radio" name="party" value="Parti C"> DEM Parti</label>
                <label><input type="radio" name="party" value="Parti D"> Milliyetçi Hareket Partisi</label>
                <label><input type="radio" name="party" value="Parti E"> Zafer Partisi</label>
                <label><input type="radio" name="party" value="Parti F"> Yeniden Refah Partisi</label>
                <label><input type="radio" name="party" value="Parti G"> Türkiye İşçi Partisi</label>
                <label><input type="radio" name="party" value="Parti H"> IYI Parti</label>
                <label><input type="radio" name="party" value="Diğer"> Diğer</label>
            </fieldset>
            <button type="submit" id="submitBtn" class="submit-btn">Oyumu Gönder</button>
        </form>

        <div id="messageArea" class="message" style="display:none;"></div>

        <div id="admin-controls" style="display:none;">
            <button id="showResultsBtn" class="admin-btn">Sonuçları Göster/Güncelle</button>
            <button id="resetVotesBtn" class="admin-btn" style="background-color: #dc3545;">Oyları Sıfırla</button>
        </div>
        <div id="results-container" style="display:none;">
            <h2>Anket Sonuçları</h2>
            <ul id="resultsList" class="results-list"></ul>
        </div>
    </div>

    <script>
        const pollForm = document.getElementById('pollForm');
        const submitBtn = document.getElementById('submitBtn');
        const messageArea = document.getElementById('messageArea');
        const adminControls = document.getElementById('admin-controls');
        const showResultsBtn = document.getElementById('showResultsBtn');
        const resetVotesBtn = document.getElementById('resetVotesBtn');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('resultsList');

        const parties = ["Parti A", "Parti B", "Parti C", "Parti D", "Parti E", "Parti F", "Parti G", "Parti H", "Diğer"];

        document.addEventListener('DOMContentLoaded', () => {
            initializeVotes();
            checkIfVoted();
            checkAdminStatus();
        });

        function initializeVotes() {
            let votes = JSON.parse(localStorage.getItem('pollVotes'));
            if (!votes) {
                votes = {};
                parties.forEach(party => {
                    votes[party] = 0;
                });
                localStorage.setItem('pollVotes', JSON.stringify(votes));
            } else { // Eğer votes varsa ama bazı yeni partiler eklenmişse (parti listesi güncellendiyse)
                let updated = false;
                parties.forEach(party => {
                    if (typeof votes[party] === 'undefined') {
                        votes[party] = 0;
                        updated = true;
                    }
                });
                if (updated) {
                    localStorage.setItem('pollVotes', JSON.stringify(votes));
                }
            }
        }

        function checkIfVoted() {
            if (localStorage.getItem('hasVoted') === 'true') { // Değeri string 'true' olarak kontrol et
                disableVoting('Daha önce oy kullandınız. Teşekkürler!');
            }
        }

        function checkAdminStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('admin') && urlParams.get('admin') === 'true') {
                adminControls.style.display = 'block';
                 // Admin giriş yaptığında, oy kullanma durumunu sıfırlama seçeneği sunabiliriz veya
                 // oy kullanma engelini kaldırabiliriz ki admin test edebilsin.
                 // Şimdilik adminin oy kullanma engeli devam etsin, sadece sonuçları görsün.
                 // Eğer adminin de tekrar oy kullanabilmesini isterseniz, aşağıdaki satırları aktif edebilirsiniz:
                 /*
                 localStorage.removeItem('hasVoted');
                 submitBtn.disabled = false;
                 pollForm.querySelectorAll('input[type="radio"]').forEach(radio => {
                     radio.disabled = false;
                     radio.checked = false;
                 });
                 messageArea.style.display = 'none';
                 */
            }
        }

        pollForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const selectedOption = pollForm.querySelector('input[name="party"]:checked');

            if (selectedOption) {
                const vote = selectedOption.value;
                saveVote(vote);
                disableVoting('Oyunuz başarıyla kaydedildi. Teşekkürler!');
                localStorage.setItem('hasVoted', 'true');
            } else {
                showMessage('Lütfen bir seçenek belirleyin.', 'error');
            }
        });

        function saveVote(party) {
            let votes = JSON.parse(localStorage.getItem('pollVotes'));
            // initializeVotes'dan dolayı votes her zaman var olmalı
            if (typeof votes[party] !== 'undefined') {
                votes[party]++;
            } else {
                // Eğer bir şekilde parti listede yoksa (dinamik ekleme vb. senaryo için)
                votes[party] = 1;
            }
            localStorage.setItem('pollVotes', JSON.stringify(votes));
        }

        function disableVoting(messageText) {
            submitBtn.disabled = true;
            pollForm.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
            showMessage(messageText, 'success');
        }

        function showMessage(text, type) {
            messageArea.textContent = text;
            messageArea.className = `message ${type}`;
            messageArea.style.display = 'block';
        }

        showResultsBtn.addEventListener('click', () => {
            displayResults();
        });

        resetVotesBtn.addEventListener('click', () => {
            if (confirm("TÜM OYLARI ve tüm kullanıcıların 'oy kullandı' işaretlerini sıfırlamak istediğinizden emin misiniz? Bu işlem geri alınamaz!")) {
                localStorage.removeItem('pollVotes');
                // Tüm kullanıcıların 'hasVoted' bilgisini silmek için localStorage'ı komple temizlemek yerine
                // bu anahtarı siliyoruz. Eğer başka siteler de localStorage kullanıyorsa bu daha güvenli.
                // Ancak, bu sadece adminin kendi tarayıcısındaki 'hasVoted'i siler.
                // Her kullanıcının kendi tarayıcısındaki 'hasVoted'i silmek için bu kodun
                // o kullanıcıların tarayıcısında çalışması gerekir, ki bu admin panelinden mümkün değil.
                // Bu sebeple, resetVotesBtn'in 'oy kullandı' işaretini kaldırması, sadece adminin kendi
                // testleri için tekrar oy kullanabilmesini sağlar. Diğer kullanıcılar için
                // localStorage.removeItem('hasVoted'); satırını kendi konsollarında çalıştırmaları gerekir.
                // Şimdilik sadece oy verilerini ve adminin kendi oy kullanma durumunu sıfırlayalım.
                localStorage.removeItem('hasVoted'); // Adminin kendi oy verme engelini kaldırır

                initializeVotes();
                displayResults(); // Sonuçları güncelle (boş görünecek)
                showMessage('Oylar sıfırlandı. Admin olarak test için tekrar oy kullanabilirsiniz.', 'success');

                // Oy kullanma arayüzünü tekrar aktif et (sadece admin için)
                submitBtn.disabled = false;
                pollForm.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.disabled = false;
                    radio.checked = false;
                });
                // Eğer "Daha önce oy kullandınız" mesajı varsa kaldır.
                 if(messageArea.textContent.includes("Daha önce oy kullandınız") || messageArea.textContent.includes("Oyunuz başarıyla kaydedildi")) {
                     messageArea.style.display = 'none';
                 }
            }
        });

        function displayResults() {
            const votes = JSON.parse(localStorage.getItem('pollVotes'));
            resultsList.innerHTML = '';

            if (votes) {
                let totalVotes = 0;
                parties.forEach(party => { // Sadece tanımlı partileri işle
                    totalVotes += (votes[party] || 0);
                });

                parties.forEach(party => { // Sadece tanımlı partileri listele
                    const voteCount = votes[party] || 0;
                    const percentage = totalVotes > 0 ? ((voteCount / totalVotes) * 100).toFixed(1) : 0;
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span class="party-name">${party}</span>
                        <span class="party-votes">${voteCount} Oy (${percentage}%)</span>
                    `;
                    resultsList.appendChild(listItem);
                });
                 const totalListItem = document.createElement('li');
                 totalListItem.innerHTML = `
                        <span class="party-name" style="font-weight:bold; color:#007bff;">TOPLAM OY</span>
                        <span class="party-votes" style="background-color:#28a745;">${totalVotes} Oy</span>
                    `;
                resultsList.appendChild(totalListItem);

            } else {
                const listItem = document.createElement('li');
                listItem.textContent = 'Henüz hiç oy kullanılmamış.';
                resultsList.appendChild(listItem);
            }
            resultsContainer.style.display = 'block';
        }
    </script>
</body>
</html>
